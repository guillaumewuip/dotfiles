#!/bin/bash

sudo yabai --load-sa
yabai -m signal --add event=dock_did_restart action="sudo yabai --load-sa"

# global settings
yabai -m config external_bar all:38:0 \
	mouse_follows_focus on \
	focus_follows_mouse autofocus \
	window_placement second_child \
	split_ratio 0.50 \
	auto_balance off \
	window_opacity on \
	active_window_opacity 1.0 \
	normal_window_opacity 0.70 \
	window_opacity_duration 0.0 \
	window_shadow on \
	window_border off \
	window_border_width 4 \
	active_window_border_color 0xFFFF0000 \
	normal_window_border_color 0x01000000 \
	mouse_modifier fn \
	mouse_action1 move \
	mouse_action2 resize \
	layout bsp \
	top_padding 10 \
	bottom_padding 10 \
	left_padding 10 \
	right_padding 110 \
	window_gap 10

yabai -m rule --add app=Moniteur manage=off
yabai -m rule --add app=Finder title=Copy manage=off

yabai -m rule --add app="^Slack$" scratchpad=slack grid=10:10:1:1:10:8
yabai -m rule --add app="^Tana$" scratchpad=tana grid=20:20:1:1:19:18

# focus window below when closing a window
yabai -m signal --add event=window_destroyed action="yabai -m query --windows --window &> /dev/null || yabai -m window --focus mouse"
yabai -m signal --add event=application_terminated action="yabai -m query --windows --window &> /dev/null || yabai -m window --focus mouse"

# trigger sketchybar window_focus event on window focus change
yabai -m signal --add event=window_focused action="sketchybar --trigger window_focus WINDOW_ID=\"\$YABAI_WINDOW_ID\""
yabai -m signal --add event=window_title_changed action="sketchybar --trigger title_change WINDOW_ID=\"\$YABAI_WINDOW_ID\""

echo "yabai configuration loaded.."
